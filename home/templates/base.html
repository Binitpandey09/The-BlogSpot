<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    {% load static %}

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Custom Layout CSS -->
    <link href="{% static 'css/layout.css' %}" rel="stylesheet" />

    <title>{% block title %}{% endblock %}</title>

    {% block external_css %}{% endblock %}

    <style>
      /* --- NAVBAR PROFILE IMAGE --- */
      .nav-profile-img {
          width: 38px;
          height: 38px;
          border-radius: 50%;
          object-fit: cover;
          cursor: pointer;
          border: 2px solid #fff;
      }

      /* --- PAGE-LEVEL CSS INSERTED HERE --- */
      {% block css %}{% endblock %}
    </style>
  </head>

  <body>
    <!-- ================= NAVBAR ================= -->
    <nav class="navbar navbar-light bg-white border-bottom px-3 sticky-top">
      <div class="d-flex align-items-center gap-3">
        <!-- Left Sidebar Toggle -->
        <button class="btn btn-light border-0" id="sidebar-toggle-btn">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Brand -->
        <a class="navbar-brand fs-4" href="/">The BlogSpot</a>

        <!-- Search -->
        <form
          method="POST"
          action="/search/"
          class="d-none d-md-flex ms-4 w-50"
        >
          {% csrf_token %}
          <input
            type="search"
            class="form-control"
            name="searched"
            placeholder="Search"
          />
        </form>
      </div>

      <div class="d-flex align-items-center gap-3">
        {% if user.is_authenticated %}
        <!-- Write Button -->
        <a href="/add_blogs/" class="btn btn-outline-dark">Write</a>

        <!-- Notification -->
        <button class="btn btn-light border-0">
          <i class="bi bi-bell"></i>
        </button>

        <!-- Profile Dropdown -->
        <div class="dropdown">
          <img
            src="{% if user.profile.image %}{{ user.profile.image.url }}{% else %}{% static 'img/default-avatar.png' %}{% endif %}"
            class="nav-profile-img dropdown-toggle"
            data-bs-toggle="dropdown"
          />

          <ul class="dropdown-menu dropdown-menu-end">
            <li class="px-3 py-2">
              <strong>{{ user.get_full_name|default:user.username }}</strong
              ><br />
              <small class="text-muted">{{ user.email }}</small>
            </li>

            <hr class="dropdown-divider" />

            <li><a class="dropdown-item" href="/profile/">View Profile</a></li>
            <li><a class="dropdown-item" href="/add_blogs/">Write</a></li>
            <li><a class="dropdown-item" href="#">Settings</a></li>
            <li><a class="dropdown-item" href="#">Help</a></li>

            <hr class="dropdown-divider" />

            <li>
              <a class="dropdown-item text-danger" href="/logout/">Sign Out</a>
            </li>
          </ul>
        </div>

        {% else %}
        <a href="/login/" class="btn btn-outline-dark">Login</a>
        <a href="/register/" class="btn btn-dark">Sign Up</a>
        {% endif %}
      </div>
    </nav>

    <!-- ================= LAYOUT CONTAINER ================= -->
    <div class="layout-container" id="main-layout">
      <!-- ========== LEFT SIDEBAR ========== -->
      <aside class="sidebar-container">
        <a href="/" class="menu-item">
          <span class="menu-icon">üè†</span>
          <span class="menu-text">Home</span>
        </a>

        <a href="#" class="menu-item">
          <span class="menu-icon">üîñ</span>
          <span class="menu-text">Library</span>
        </a>

        <a href="/profile/" class="menu-item">
          <span class="menu-icon">üë§</span>
          <span class="menu-text">Profile</span>
        </a>

        <a href="#" class="menu-item">
          <span class="menu-icon">üìù</span>
          <span class="menu-text">Stories</span>
        </a>

        <a href="#" class="menu-item">
          <span class="menu-icon">üìä</span>
          <span class="menu-text">Stats</span>
        </a>

        <hr />

        <a href="#" class="menu-item">
          <span class="menu-icon">üë•</span>
          <span class="menu-text">Following</span>
        </a>

        <a href="#" class="menu-item">
          <span class="menu-icon">‚ûï</span>
          <span class="menu-text">Find Writers</span>
        </a>
      </aside>

      <!-- ========== MAIN PAGE CONTENT ========== -->
      <main class="main-content">{% block body %}{% endblock %}</main>
    </div>

    <!-- Bootstrap + Custom JS -->
    <script src="{% static 'js/layout.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    {% block js %}{% endblock %}
  </body>
</html>
